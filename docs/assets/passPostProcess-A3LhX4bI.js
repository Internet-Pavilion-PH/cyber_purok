const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pass.fragment-Yntaa2B-.js","assets/index-UeNFZPFr.js","assets/index-BzEWNIgQ.css","assets/pass.fragment-Dwr4VMpR.js","assets/passCube.fragment-BjHZPdWZ.js","assets/passCube.fragment-DDg9OzbL.js"])))=>i.map(i=>d[i]);
import{g as W,h as Y,a as G,C as E,i as y,V as s,E as D,f as I,j as L,k as B,l as Z,s as j,A as q,P as U,m as X}from"./index-UeNFZPFr.js";class P{constructor(e,a,r,n){this.name=e,this.worldAxisForNormal=a,this.worldAxisForFileX=r,this.worldAxisForFileY=n}}class O{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const a=e.getSize().width,r=e.readPixels(0,void 0,void 0,!1),n=e.readPixels(1,void 0,void 0,!1);let i,t;e.isRenderTarget?(i=e.readPixels(3,void 0,void 0,!1),t=e.readPixels(2,void 0,void 0,!1)):(i=e.readPixels(2,void 0,void 0,!1),t=e.readPixels(3,void 0,void 0,!1));const d=e.readPixels(4,void 0,void 0,!1),g=e.readPixels(5,void 0,void 0,!1),f=e.gammaSpace,N=5;let C=0;return(e.textureType==1||e.textureType==2)&&(C=1),new Promise(S=>{Promise.all([n,r,i,t,d,g]).then(([w,F,u,m,h,p])=>{const _={size:a,right:F,left:w,up:u,down:m,front:h,back:p,format:N,type:C,gammaSpace:f};S(this.ConvertCubeMapToSphericalPolynomial(_))})})}static _AreaElement(e,a){return Math.atan2(e*a,Math.sqrt(e*e+a*a+1))}static ConvertCubeMapToSphericalPolynomial(e){const a=new W;let r=0;const n=2/e.size,i=n,t=.5*n,d=t-1;for(let S=0;S<6;S++){const w=this._FileFaces[S],F=e[w.name];let u=d;const m=e.format===5?4:3;for(let h=0;h<e.size;h++){let p=d;for(let _=0;_<e.size;_++){const z=w.worldAxisForFileX.scale(p).add(w.worldAxisForFileY.scale(u)).add(w.worldAxisForNormal);z.normalize();const v=this._AreaElement(p-t,u-t)-this._AreaElement(p-t,u+t)-this._AreaElement(p+t,u-t)+this._AreaElement(p+t,u+t);let l=F[h*e.size*m+_*m+0],o=F[h*e.size*m+_*m+1],c=F[h*e.size*m+_*m+2];isNaN(l)&&(l=0),isNaN(o)&&(o=0),isNaN(c)&&(c=0),e.type===0&&(l/=255,o/=255,c/=255),e.gammaSpace&&(l=Math.pow(E(l),y),o=Math.pow(E(o),y),c=Math.pow(E(c),y));const T=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const k=Math.max(l,o,c);if(k>T){const b=T/k;l*=b,o*=b,c*=b}}else l=E(l,0,T),o=E(o,0,T),c=E(c,0,T);const H=new Y(l,o,c);a.addLight(z,H,v),r+=v,p+=n}u+=i}}const C=4*Math.PI*6/6/r;return a.scaleInPlace(C),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),G.FromHarmonics(a)}}O._FileFaces=[new P("right",new s(1,0,0),new s(0,0,-1),new s(0,-1,0)),new P("left",new s(-1,0,0),new s(0,0,1),new s(0,-1,0)),new P("up",new s(0,1,0),new s(1,0,0),new s(0,0,1)),new P("down",new s(0,-1,0),new s(1,0,0),new s(0,0,-1)),new P("front",new s(0,0,1),new s(1,0,0),new s(0,-1,0)),new P("back",new s(0,0,-1),new s(-1,0,0),new s(0,-1,0))];O.MAX_HDRI_VALUE=4096;O.PRESERVE_CLAMPED_COLORS=!1;class A extends D{_gatherImports(e,a){e?(this._webGPUReady=!0,a.push(Promise.all([I(()=>import("./pass.fragment-Yntaa2B-.js"),__vite__mapDeps([0,1,2]))]))):a.push(Promise.all([I(()=>import("./pass.fragment-Dwr4VMpR.js"),__vite__mapDeps([3,1,2]))])),super._gatherImports(e,a)}constructor(e,a=null,r){const n={name:e,engine:a||L.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:A.FragmentUrl,...r};n.engine||(n.engine=L.LastCreatedEngine),super(n)}}A.FragmentUrl="pass";class R extends D{_gatherImports(e,a){e?(this._webGPUReady=!0,a.push(Promise.all([I(()=>import("./passCube.fragment-BjHZPdWZ.js"),__vite__mapDeps([4,1,2]))]))):a.push(Promise.all([I(()=>import("./passCube.fragment-DDg9OzbL.js"),__vite__mapDeps([5,1,2]))])),super._gatherImports(e,a)}constructor(e,a=null,r){super({...r,name:e,engine:a||L.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:R.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ");break}}}R.FragmentUrl="passCube";class M extends U{getClassName(){return"PassPostProcess"}constructor(e,a,r=null,n,i,t,d=0,g=!1){const f={size:typeof a=="number"?a:void 0,camera:r,samplingMode:n,engine:i,reusable:t,textureType:d,blockCompilation:g,...a};super(e,A.FragmentUrl,{effectWrapper:typeof a=="number"||!a.effectWrapper?new A(e,i,f):void 0,...f})}static _Parse(e,a,r,n){return X.Parse(()=>new M(e.name,e.options,a,e.renderTargetSamplingMode,e._engine,e.reusable),e,r,n)}}B("BABYLON.PassPostProcess",M);class x extends U{get face(){return this._effectWrapper.face}set face(e){this._effectWrapper.face=e}getClassName(){return"PassCubePostProcess"}constructor(e,a,r=null,n,i,t,d=0,g=!1){const f={size:typeof a=="number"?a:void 0,camera:r,samplingMode:n,engine:i,reusable:t,textureType:d,blockCompilation:g,...a};super(e,A.FragmentUrl,{effectWrapper:typeof a=="number"||!a.effectWrapper?new R(e,i,f):void 0,...f})}static _Parse(e,a,r,n){return X.Parse(()=>new x(e.name,e.options,a,e.renderTargetSamplingMode,e._engine,e.reusable),e,r,n)}}Z([j()],x.prototype,"face",null);q._RescalePostProcessFactory=V=>new M("rescale",1,null,2,V,!1,0);export{O as C};
